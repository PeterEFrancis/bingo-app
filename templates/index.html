<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta charset="utf-8">

    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>

    <title>
      Bingo
    </title>
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:400&display=swap" rel="stylesheet">
    <style>
      body {
        background-color: white;
      }

      * {
        font-family: 'Ubuntu', sans-serif;
        font-size: 16pt;
        color: black;
      }

      h1 {
        font-size: 50pt;
      }

      h3 {
        font-size: 20pt;
        margin: 15px 0px 15px;
      }


    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
          <h1 class="text-center">Bingo Caller</h1>
          <img src={{ url_for('static', filename='bingo.png') }} class="center-block" style="max-width:300px; margin-top:60px; margin-bottom: 60px;" />
          <p class="text-center">This is a free and simple Bingo caller and card generator, perfect for any Bingo game!</p>
          <br>
          <button type="button" class="btn btn-lg btn-block btn-default center-block"
                    onclick="window.location.href='caller/p'">
              <h3 class="text-center">Open Caller</h3>
          </button>
          <br>
          <button type="button" class="btn btn-lg btn-block btn-default center-block"
                  onclick="window.location.href='card'">
            <h3 class="text-center">Get a Random Card</h3>
          </button>
          <br>
          <button type="button" class="btn btn-lg btn-block btn-default center-block"
                  data-toggle="modal" data-target="#generate">
            <h3 class="text-center">Generate a Game</h3>
          </button>
        </div>
        <div class="col-md-3"></div>
      </div>
    </div>








    <div id="generate" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Generate Cards for a Game</h4>
          </div>
          <div class="modal-body">
            <form id="generate_form" role="form">
              <div class="form-group">
                <label for="name">Game Name:</label>
                <input type="text" class="form-control" id="name" name="name">
              </div>
              <div class="form-group">
                <label for="players">Enter a List of Players:</label>
                <textarea id="players" name="players" class="form-control" rows="5"></textarea>
              </div>
              <div class="form-group">
                <label for="number">Number of cards per player:</label>
                <input type="text" class="form-control" id="number">
              </div>
              <p style="color:red; padding: 0px 0px 0px 5px" id="error">&nbsp</p>
              <button type="button" class="btn btn-success center-block" style="width:100%" id="create" onclick="generate();">
                <h3 class="text-center">Generate!</h3>
              </button>
              <br>
              <p class="">
                <a id="link" href="" target="_blank"></a>
              </p>
            </form>
          </div>
        </div>

      </div>
    </div>

<script>

  function generate() {
    var name = document.getElementById('name').value.trim();
    var players = document.getElementById('players').value.trim();
    var number = Number(document.getElementById('number').value.trim());

    var error = document.getElementById('error');

    if (name === "") {
      console.log("no-name error");
      error.innerHTML = "You must enter a game name --- make it something fun ;)";
      return;
    }
    if (players === "") {
      console.log("no-players error");
      error.innerHTML = "You must enter at least one player. If you don't want to enter names, just enter numbers!";
      return;
    }
    if (number === "") {
      console.log("no-number error");
      error.innerHTML = "You must enter a number of cards per player";
      return;
    }
    if (!(Number.isInteger(number)) || number < 1) {
      console.log("number error");
      error.innerHTML = number + " is not a valid number of cards per player (must be a positive whole number).";
      return;
    }


    var players_list = players.split('\n');
    for (i = 0; i < players_list.length; i++) {
      if (players_list[i] != "") {
        players_list[i] = players_list[i].trim();
      }
    }
    var players_list_uniques = [];
    $.each(players_list, function(i, el){
        if($.inArray(el, players_list_uniques) === -1) players_list_uniques.push(el);
    });
    if (players_list.length != players_list_uniques.length) {
      console.log("player duplicate error");
      error.innerHTML = "You cannot enter duplicate players.";
      return;
    }


    // all checks pass!

    player_string = players_list_uniques[0];
    for (i = 1; i < players_list_uniques.length; i++) {
      player_string += "&" + players_list_uniques[i];
    }


    $.ajax({
      url: '/generate',
      data: {name:name, players:player_string, number:number},
      type: 'POST',
      cache: false,
      success: function(response){
        var link = document.getElementById('link');
        link.innerHTML = 'This is your shareable link!';
        link.href = response;
      },
      error: function(error){
        console.log(error);
      },
    });

  }


</script>




  </body>
</html>
